#
#
#
#

PORT=6379

response=$(lsof -i tcp:$PORT | grep LISTEN | awk '{print $2, $9, $5}')

if ! command -v lsof &> /dev/null; then
    echo "lsof command not found."
    exit 1
elif [ -z "$response" ]; then
    echo "Redis not found with TCP port $PORT."
    exit 1
fi

echo "$response" | while read pid ip ipv; do
    kill -15 $pid
    if [ $? -eq 0 ]; then
        echo "Gracefully stopped  redis with PID: $pid, IP-Address: $ip, IP-Version: $ipv (Port: $PORT)"
    else
        echo "Failed to gracefully stop redis with PID: $pid, IP-Address: $ip, IP-Version: $ipv (Port: $PORT). Attempting forced kill."
        kill -9 "$pid"
        if [ $? -eq 0 ]; then
            echo "Successfully forced termination of redis with PID: $pid, IP-Address: $ip, IP-Version: $ipv (Port: $PORT)"
        else
            echo "Failed to stop redis with PID: $pid, IP-Address: $ip, IP-Version: $ipv (Port: $PORT)"
        fi
    fi
done


